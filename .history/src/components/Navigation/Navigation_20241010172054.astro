---
import { Menu } from "lucide-react";
import Icon from "../AstroIcon.astro";
import { NavigationDropdown } from "./NavigationDropdown"; // 导航栏的下拉菜单
import { AccountDropdown } from "./AccountDropdown"; // 用户账户的下拉菜单
import { getUser, isLoggedIn } from "../../lib/jwt.ts"; // token和cookies   处理用户身份验证和获取用户信息
---

<div class="bg-slate-900 py-5 text-white sm:py-8">
  <nav class="container flex items-center justify-between">
    <div class="flex items-center gap-5">
      <!-- logo -->
      <a
        class="flex items-center text-lg font-medium text-white"
        href="/"
        aria-label="roadmap.sh"
      >
        <Icon icon="logo" />
      </a>

      <!-- Desktop navigation items -->
      <div class="hidden space-x-5 sm:flex sm:items-center">
        <NavigationDropdown client:load />
        <!-- <a href="/get-started" class="text-gray-400 hover:text-white">
          从这里开始
        </a> -->
        <!-- GPT 路线图 -->
        <a href="/ai" class="text-gray-400 hover:text-white"> AI Roadmaps</a>
        <button
          data-command-menu
          style={{ width: "350px", marginTop: "3px" }}
          class="hidden items-center rounded-md border border-gray-800 px-2.5 py-1.5 text-sm text-gray-400 hover:cursor-pointer hover:bg-gray-800 md:flex"
        >
          <Icon icon="search" class="h-3 w-3" />
          <span class="ml-2">搜索</span>
        </button>
      </div>
    </div>

    {
      isLoggedIn && (
        <ul class="hidden h-8 w-[172px] items-center justify-end gap-5 sm:flex">
          <li data-guest-required class="hidden">
            <a href="/login" class="text-gray-400 hover:text-white">
              登录
            </a>
          </li>
          <li>
            <a
              data-guest-required
              class="flex hidden h-8 w-28 cursor-pointer items-center justify-center rounded-full bg-gradient-to-r from-blue-500 to-blue-700 px-4 py-2 text-sm font-medium text-white hover:from-blue-500 hover:to-blue-600"
              href="/signup"
            >
              <span>注册</span>
            </a>
          </li>
        </ul>
      )
    }

    {
      !isLoggedIn && (
        <ul class="hidden h-8 w-[172px] items-center justify-end gap-5 sm:flex">
          <li>
            <a
              data-guest-required
              class="flex hidden h-8 w-28 cursor-pointer items-center justify-center rounded-full bg-gradient-to-r from-blue-500 to-blue-700 px-4 py-2 text-sm font-medium text-white hover:from-blue-500 hover:to-blue-600"
              href="/account"
            >
              <span>我的</span>
            </a>
          </li>
        </ul>
      )
    }
    <!-- <ul class="hidden h-8 w-[172px] items-center justify-end gap-5 sm:flex">
      <li data-guest-required class="hidden">
        <a href="/login" class="text-gray-400 hover:text-white">登录</a>
      </li>
      <li>
        <AccountDropdown client:only="react" />
        <a
          data-guest-required
          class="flex hidden h-8 w-28 cursor-pointer items-center justify-center rounded-full bg-gradient-to-r from-blue-500 to-blue-700 px-4 py-2 text-sm font-medium text-white hover:from-blue-500 hover:to-blue-600"
          href="/signup"
        >
          <span>注册</span>
        </a>
      </li>
    </ul> -->

    <!-- 移动手机端 Navigation Button -->
    <button
      class="block cursor-pointer text-gray-400 hover:text-gray-50 sm:hidden"
      aria-label="Menu"
      data-show-mobile-nav
    >
      <Icon icon="hamburger" />
    </button>

    <!-- 移动手机端 Navigation Items -->
    <div
      class="fixed bottom-0 left-0 right-0 top-0 z-40 flex hidden items-center bg-slate-900"
      data-mobile-nav
    >
      <button
        data-close-mobile-nav
        class="absolute right-6 top-6 block cursor-pointer text-gray-400 hover:text-gray-50"
        aria-label="Close Menu"
      >
        <Icon icon="close" />
      </button>
      <ul class="flex w-full flex-col items-center gap-2 md:gap-3">
        <li>
          <a href="/roadmaps" class="text-xl hover:text-blue-300 md:text-lg">
            Roadmaps
          </a>
        </li>
        <!-- <li>
          <a
            href="/best-practices"
            class="text-xl hover:text-blue-300 md:text-lg"
          >
            最佳实践
          </a>
        </li> -->
        <!-- <li>
          <a href="/guides" class="text-xl hover:text-blue-300 md:text-lg">
            指南
          </a>
        </li> -->
        <li>
          <a href="/videos" class="text-xl hover:text-blue-300 md:text-lg">
            视频
          </a>
        </li>

        <!-- Links for logged in users -->
        <li data-auth-required class="hidden">
          <a href="/account" class="text-xl hover:text-blue-300 md:text-lg">
            账号
          </a>
        </li>
        <!-- <li data-auth-required class="hidden">
          <a href="/team" class="text-xl hover:text-blue-300 md:text-lg">
            团队
          </a>
        </li> -->
        <li data-auth-required class="hidden">
          <button
            data-logout-button
            class="text-xl text-red-300 hover:text-red-400 md:text-lg"
          >
            登出
          </button>
        </li>
        <li>
          <a
            data-guest-required
            href="/login"
            class="hidden text-xl text-white md:text-lg"
          >
            登录
          </a>
        </li>
        <li>
          <a
            data-guest-required
            href="/signup"
            class="hidden text-xl text-green-300 hover:text-green-400 md:text-lg"
          >
            注册
          </a>
        </li>
      </ul>
    </div>
  </nav>
</div>

<script src="./navigation.ts"></script>
